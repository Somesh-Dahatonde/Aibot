import React, { useState, useEffect } from "react";
import axios from "axios";

function Generator(prop) {
  console.log(prop.prop);
  const [messages, setMessages] = useState([]);

  const handleResponse = async (input) => {
    // console.log(input);
    const encodedParams = new URLSearchParams();
    encodedParams.set("in", "what is your name ");
    encodedParams.set("op", "in");
    encodedParams.set("cbot", "1");
    encodedParams.set("SessionID", "RapidAPI1");
    encodedParams.set("cbid", "1");
    encodedParams.set("key", "RHMN5hnQ4wTYZBGCF3dfxzypt68rVP");
    encodedParams.set("ChatSource", "RapidAPI");
    encodedParams.set("duration", "1");

    const options = {
      method: "POST",
      url: "https://robomatic-ai.p.rapidapi.com/api",
      headers: {
        "content-type": "application/x-www-form-urlencoded",
        "X-RapidAPI-Key": "06d0b44926msh1d7f9a6687fb263p1147fejsn7142c6589dab",
        "X-RapidAPI-Host": "robomatic-ai.p.rapidapi.com",
      },
      data: encodedParams,
    };

    try {
      const response = await axios.request(options);
      console.log("waiting for response");
      const responseData = response.data;
      displayMessage(input);
      displayMessage(responseData.out);
      console.log(responseData);
    } catch (error) {
      console.error(error);
    }
  };

  const displayMessage = (message) => {
    setMessages((prevMessages) => [...prevMessages, message]);
  };

  useEffect(() => {
    handleResponse(prop.prop);
  }, [prop.prop]);

  return (
    <>
      <div className="chat chat-start">
        {messages.map((message, index) => (
          <div className="chat-bubble" key={index}>
            {message.out}
          </div>
        ))}
      </div>
      <div className="chat chat-end">
        <div className="chat-bubble" id="chat-bubble"></div>
      </div>
    </>
  );
}

export default Generator;
